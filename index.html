<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenPeticiones</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#722F37">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="GenPeticiones">
    <meta name="msapplication-TileColor" content="#722F37">
    <meta name="msapplication-TileImage" content="./icon-144.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Iconos principales para PWA -->
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="shortcut icon" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    
    <!-- Meta tags adicionales para PWA -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="GenPeticiones">
    
    <!-- Librer√≠as externas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh; 
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            max-width: 400px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Logo Section */
        .logo-section {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            width: 100%;
            max-width: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            max-height: 280px;
            overflow: hidden;
            box-sizing: border-box;
            margin: 0 auto;
        }
        
        .logo-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 280px;
            margin: 0 auto;
        }
        
        /* C√≠rculo completo del logo */
        .logo-circle {
            position: relative;
            width: var(--logo-size, 160px);
            height: var(--logo-size, 160px);
            margin: 0 auto;
            border: var(--logo-border, 11px) solid #722F37;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }
        
        /* Barra verde superior */
        .logo-circle::before {
            content: '';
            position: absolute;
            top: var(--bar-top, 27px);
            left: 50%;
            transform: translateX(-50%);
            width: var(--bar-width, 70px);
            height: var(--bar-height, 11px);
            background: #A4C639;
            border-radius: calc(var(--bar-height, 11px) / 2);
        }
        
        /* Barra verde inferior */
        .logo-circle::after {
            content: '';
            position: absolute;
            bottom: var(--bar-top, 27px);
            left: 50%;
            transform: translateX(-50%);
            width: var(--bar-width, 70px);
            height: var(--bar-height, 11px);
            background: #A4C639;
            border-radius: calc(var(--bar-height, 11px) / 2);
        }
        
        .logo-gen {
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: -3px;
            position: relative;
            z-index: 2;
        }
        
        .logo-gen .g { color: #722F37; }
        .logo-gen .e { color: #A4C639; }
        .logo-gen .n { color: #722F37; }
        
        /* L√°piz de edici√≥n (solo visible para admin) */
        .logo-edit-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        
        .logo-edit-btn:hover {
            background: #5a6fd8;
            transform: scale(1.1);
        }
        
        /* Botones principales */
        .main-buttons {
            display: flex;
            gap: 15px;
        }
        
        .main-button {
            flex: 1;
            background: white;
            border: none;
            border-radius: 15px;
            padding: 25px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .admin-button {
            background: #722F37;
            color: #A4C639;
        }
        
        .admin-button:hover {
            background: #5a252a;
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(114, 47, 55, 0.3);
        }
        
        .consultar-button {
            background: #A4C639;
            color: #722F37;
        }
        
        .consultar-button:hover {
            background: #8fb332;
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(164, 198, 57, 0.3);
        }
        
        .button-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .button-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .button-subtitle {
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.9;
        }
        
        /* Bot√≥n Empezamos */
        .empezamos-button {
            width: 100%;
            background: #000000;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .empezamos-button:hover {
            background: #333333;
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
        }
        
        /* Modal de Login */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .modal-buttons button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-login {
            background: #667eea;
            color: white;
        }
        
        .btn-login:hover {
            background: #5a6fd8;
        }
        
        .btn-cancel {
            background: #6c757d;
            color: white;
        }
        
        .btn-cancel:hover {
            background: #5a6268;
        }
        
        .hidden { display: none !important; }
        
        /* Panel de Administraci√≥n */
        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .admin-container {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .admin-header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }
        
        .admin-header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .admin-header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .admin-status {
            background: #A4C639;
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .admin-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .admin-card h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .credentials-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .credential-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .credential-group h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .credential-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .credential-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .credential-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-purple {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-purple:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-green {
            background: #A4C639;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-green:hover {
            background: #8fb332;
            transform: translateY(-2px);
        }
        
        .upload-area {
            border: 3px dashed #A4C639;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        
        .upload-area:hover {
            background: #e9ecef;
            border-color: #8fb332;
        }
        
        .upload-area.dragover {
            background: #e8f5e8;
            border-color: #A4C639;
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .upload-subtext {
            font-size: 0.9rem;
            color: #666;
        }
        
        .member-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .member-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .member-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .member-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        
        .member-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .member-buttons {
            display: flex;
            gap: 15px;
        }
        
        .btn-add {
            background: #A4C639;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .btn-add:hover {
            background: #8fb332;
            transform: translateY(-2px);
        }
        
        .btn-clear {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 0.5;
        }
        
        .btn-clear:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .admin-footer {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-home {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-home:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn-logout {
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-logout:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        /* Pantalla de Consultar Peticiones */
        .consultar-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .consultar-container {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .consultar-header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }
        
        .consultar-header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .consultar-header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .search-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .search-card h2 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        .search-select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .pdfs-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .pdfs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .pdfs-header h2 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pdf-count {
            background: #A4C639;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .pdfs-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .pdf-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .pdf-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .pdf-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.3;
        }
        
        .pdf-date {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 8px;
        }
        
        .pdf-info {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 12px;
        }
        
        .pdf-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-download {
            background: #A4C639;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .btn-download:hover {
            background: #8fb332;
            transform: translateY(-1px);
        }
        
        .btn-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 0.7;
        }
        
        .btn-delete:hover {
            background: #c82333;
            transform: translateY(-1px);
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .pagination-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pagination-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }
        
        .pagination-btn.active {
            background: #667eea;
            color: white;
        }
        
        .pagination-btn:disabled {
            background: #f8f9fa;
            color: #ced4da;
            cursor: not-allowed;
            transform: none;
        }
        
        .consultar-footer {
            text-align: center;
            margin-top: 20px;
        }
        
        .btn-back {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .btn-back:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        /* Pantalla de Empezamos */
        .empezamos-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5f5f5;
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .empezamos-container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 25px;
            padding: 40px 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .person-avatar {
            width: 80px;
            height: 80px;
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            font-size: 2.5rem;
            color: #667eea;
        }
        
        .person-form {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .person-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .person-label {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
        }
        
        .person-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            font-size: 16px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .person-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .person-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            font-size: 14px;
            background: #f8f9fa;
            resize: vertical;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        .person-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .person-separator {
            height: 2px;
            background: linear-gradient(90deg, transparent, #e9ecef, transparent);
            margin: 20px 0;
        }
        
        .person-navigation {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-anterior {
            background: #667eea;
            color: white;
        }
        
        .btn-anterior:hover:not(:disabled) {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-siguiente {
            background: #667eea;
            color: white;
        }
        
        .btn-siguiente:hover:not(:disabled) {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-siguiente.finalizar {
            background: #A4C639;
        }
        
        .btn-siguiente.finalizar:hover:not(:disabled) {
            background: #8fb332;
        }
        
        .person-counter {
            background: #A4C639;
            color: white;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .empezamos-footer {
            text-align: center;
        }
        
        .btn-inicio {
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
        }
        
        .btn-inicio:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        /* Bot√≥n de eliminar persona (solo admin) */
        .delete-person-btn {
            position: absolute;
            top: 0;
            right: -10px;
            width: 30px;
            height: 30px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);
            transition: all 0.3s ease;
        }
        
        .delete-person-btn:hover {
            background: #c82333;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }
        
        /* Pantalla Final de Proceso Completado */
        .final-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5f5f5;
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .final-container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 25px;
            padding: 40px 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .final-header {
            margin-bottom: 30px;
        }
        
        .final-title {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .final-subtitle {
            font-size: 1rem;
            color: #666;
            line-height: 1.5;
        }
        
        .stats-container {
            background: #e8f5e8;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: #A4C639;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
        }
        
        .pdf-options {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .pdf-options h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .filter-options {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .filter-option {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .filter-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .filter-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .btn-download-final {
            background: #667eea;
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
        }
        
        .btn-download-final:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .admin-save-section {
            background: #722F37;
            color: white;
            border-radius: 20px;
            padding: 20px;
            margin: 30px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 600;
        }
        
        .admin-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .final-navigation {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-back-final {
            background: #e9ecef;
            color: #333;
            border: none;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-back-final:hover {
            background: #dee2e6;
            transform: translateY(-2px);
        }
        
        .btn-home-final {
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-home-final:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-discard {
            background: #dc3545;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-discard:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .container { padding: 0 10px; }
            .logo-gen { font-size: 3rem; }
            .main-buttons { flex-direction: column; }
            .main-button { padding: 20px; }
            .button-icon { font-size: 1.5rem; }
            .button-title { font-size: 0.9rem; }
            .button-subtitle { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Section -->
        <div class="logo-section">
            <div class="logo-container">
                <div class="logo-circle">
                    <div class="logo-gen">
                        <span class="g">G</span><span class="e">E</span><span class="n">N</span>
                    </div>
                </div>
            </div>
            
            <!-- L√°piz de edici√≥n (solo visible para admin) -->
            <button id="logoEditBtn" class="logo-edit-btn hidden" onclick="editLogo()" title="Editar logo">
                ‚úèÔ∏è
            </button>
        </div>
        
        <!-- Botones principales -->
        <div class="main-buttons">
            <button id="adminButton" class="main-button admin-button" onclick="showAdminLogin()">
                <div id="adminIcon" class="button-icon">üë®‚Äçüíº</div>
                <div id="adminTitle" class="button-title">ACCESO</div>
                <div id="adminSubtitle" class="button-subtitle">ADMINISTRADOR</div>
            </button>
            
            <button class="main-button consultar-button" onclick="goToConsultar()">
                <div class="button-icon">üìã</div>
                <div class="button-title">CONSULTAR</div>
                <div class="button-subtitle">PETICIONES</div>
            </button>
        </div>
        
        <!-- Bot√≥n Empezamos -->
        <button class="empezamos-button" onclick="goToEmpezamos()">
            <span>‚≠ê</span>
            <span>EMPEZAMOS</span>
        </button>
    </div>
    
    <!-- Modal de Login de Administrador -->
    <div id="adminModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">üîê Acceso Administrador</div>
            <div class="form-group">
                <label>Usuario:</label>
                <input type="text" id="adminUser" placeholder="admin" autocomplete="username">
            </div>
            <div class="form-group">
                <label>Contrase√±a:</label>
                <input type="password" id="adminPass" placeholder="123456" autocomplete="current-password">
            </div>
            <div class="modal-buttons">
                <button class="btn-login" onclick="handleAdminLogin()">üîì Iniciar Sesi√≥n</button>
                <button class="btn-cancel" onclick="closeAdminModal()">‚ùå Cancelar</button>
            </div>
            
            <!-- Opciones de recuperaci√≥n -->
            <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">¬øOlvidaste tus credenciales?</p>
                <button onclick="showRecoveryOptions()" style="background: none; border: none; color: #667eea; font-size: 0.9rem; text-decoration: underline; cursor: pointer;">
                    üîë Opciones de Recuperaci√≥n
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Recuperaci√≥n de Credenciales -->
    <div id="recoveryModal" class="modal hidden">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">üîë Recuperar Credenciales</div>
            
            <!-- Opciones de recuperaci√≥n -->
            <div style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px;">
                
                <!-- Opci√≥n 1: Email de recuperaci√≥n -->
                <div class="recovery-option" onclick="selectRecoveryMethod('email')">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" id="emailOption">
                        <div style="font-size: 1.5rem;">üìß</div>
                        <div>
                            <div style="font-weight: 600; color: #333;">Env√≠o por Email</div>
                            <div style="font-size: 0.9rem; color: #666;">Recibe las credenciales por correo</div>
                        </div>
                    </div>
                </div>

                <!-- Opci√≥n 2: Patr√≥n de desbloqueo -->
                <div class="recovery-option" onclick="selectRecoveryMethod('pattern')">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" id="patternOption">
                        <div style="font-size: 1.5rem;">üîì</div>
                        <div>
                            <div style="font-weight: 600; color: #333;">Patr√≥n de Desbloqueo</div>
                            <div style="font-size: 0.9rem; color: #666;">Dibuja tu patr√≥n de seguridad</div>
                        </div>
                    </div>
                </div>

                <!-- Opci√≥n 3: Huella dactilar -->
                <div class="recovery-option" onclick="selectRecoveryMethod('fingerprint')">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" id="fingerprintOption">
                        <div style="font-size: 1.5rem;">üëÜ</div>
                        <div>
                            <div style="font-weight: 600; color: #333;">Huella Dactilar</div>
                            <div style="font-size: 0.9rem; color: #666;">Usa tu huella para acceder</div>
                        </div>
                    </div>
                </div>

                <!-- Opci√≥n 4: Pregunta de seguridad -->
                <div class="recovery-option" onclick="selectRecoveryMethod('question')">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" id="questionOption">
                        <div style="font-size: 1.5rem;">‚ùì</div>
                        <div>
                            <div style="font-weight: 600; color: #333;">Pregunta de Seguridad</div>
                            <div style="font-size: 0.9rem; color: #666;">Responde tu pregunta secreta</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contenido din√°mico seg√∫n la opci√≥n seleccionada -->
            <div id="recoveryContent" style="display: none;">
                <!-- El contenido se cargar√° din√°micamente -->
            </div>

            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeRecoveryModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Edici√≥n de Logo -->
    <div id="logoModal" class="modal hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">üé® Editar Logo</div>
            
            <!-- Vista previa del logo -->
            <div style="text-align: center; margin-bottom: 25px;">
                <div id="logoPreview" style="width: 100%; max-width: 280px; height: 200px; background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; margin: 0 auto; position: relative; overflow: hidden;">
                    <div class="logo-container" style="width: 100%; max-width: none;">
                        <div class="logo-circle">
                            <div class="logo-gen">
                                <span class="g">G</span><span class="e">E</span><span class="n">N</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Control de tama√±o -->
            <div class="form-group">
                <label>üìè Altura del logo:</label>
                <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                    <span style="font-size: 14px; color: #666;">Peque√±o</span>
                    <input type="range" id="logoSizeSlider" min="120" max="200" value="160" 
                           style="flex: 1; height: 6px; background: #ddd; border-radius: 3px; outline: none;"
                           oninput="updateLogoSize(this.value)">
                    <span style="font-size: 14px; color: #666;">Grande</span>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 14px; color: #666;">
                    Altura actual: <span id="logoSizeValue">160px</span>
                </div>
                <div style="text-align: center; margin-top: 5px; font-size: 12px; color: #999;">
                    L√≠mites optimizados para m√≥vil
                </div>
            </div>
            
            <!-- Subir nuevo logo -->
            <div class="form-group">
                <label>üìÅ Subir nuevo logo (JPG/PNG):</label>
                <input type="file" id="logoFileInput" accept=".jpg,.jpeg,.png" 
                       style="width: 100%; padding: 10px; border: 2px dashed #ddd; border-radius: 10px; background: #f9f9f9; cursor: pointer;"
                       onchange="handleLogoUpload(this)">
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    Formatos soportados: JPG, PNG (m√°ximo 2MB)
                </div>
            </div>
            
            <!-- Botones de acci√≥n -->
            <div class="modal-buttons" style="margin-top: 30px;">
                <button class="btn-login" onclick="saveLogoChanges()">üíæ Guardar Cambios</button>
                <button style="background: #dc3545; color: white; flex: 0.5;" onclick="resetLogo()">üóëÔ∏è Restaurar</button>
                <button class="btn-cancel" onclick="closeLogoModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Panel de Administraci√≥n -->
    <div id="adminPanel" class="admin-panel hidden">
        <div class="admin-container">
            <!-- Header del panel -->
            <div class="admin-header">
                <h1>üîê Panel de Administraci√≥n</h1>
                <p>Gesti√≥n completa del sistema</p>
            </div>

            <!-- Estado de conexi√≥n -->
            <div class="admin-status">
                üë§ Conectado como: <span id="adminStatusUser">Administrador</span>
            </div>

            <!-- Cambiar Credenciales -->
            <div class="admin-card">
                <h2>üîë Cambiar Credenciales</h2>
                <div class="credentials-section">
                    <!-- Cambiar Contrase√±a -->
                    <div class="credential-group">
                        <h3>üîí Cambiar Contrase√±a</h3>
                        <input type="password" id="currentPassword" class="credential-input" placeholder="Contrase√±a actual">
                        <input type="password" id="newPassword" class="credential-input" placeholder="Nueva contrase√±a">
                        <input type="password" id="confirmPassword" class="credential-input" placeholder="Confirmar contrase√±a">
                    </div>

                    <!-- Cambiar Usuario -->
                    <div class="credential-group">
                        <h3>üë§ Cambiar Usuario</h3>
                        <input type="password" id="currentPasswordUser" class="credential-input" placeholder="Contrase√±a actual">
                        <input type="text" id="currentUser" class="credential-input" placeholder="Usuario actual" readonly>
                        <input type="text" id="newUser" class="credential-input" placeholder="Nuevo nombre de usuario">
                    </div>
                </div>

                <div class="credential-buttons">
                    <button class="btn-purple" onclick="changePassword()">üîí Cambiar Contrase√±a</button>
                    <button class="btn-green" onclick="changeUsername()">üë§ Cambiar Usuario</button>
                </div>
            </div>

            <!-- Subir Base de Datos -->
            <div class="admin-card">
                <h2>üìÅ Subir Base de Datos</h2>
                <div class="upload-area" onclick="document.getElementById('databaseFile').click()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">Arrastra un archivo o haz clic para seleccionar</div>
                    <div class="upload-subtext">Formatos soportados: TXT (nombre/empresa por l√≠neas), CSV, JSON (m√°x. 5MB)</div>
                </div>
                <input type="file" id="databaseFile" accept=".txt,.csv,.json" style="display: none;" onchange="handleDatabaseUpload(this)">
                <div style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    <strong>Formato TXT:</strong> Una l√≠nea para el nombre, siguiente l√≠nea para la empresa, y as√≠ sucesivamente.
                </div>
            </div>

            <!-- A√±adir Nuevo Miembro -->
            <div class="admin-card">
                <h2>üë• A√±adir Nuevo Miembro</h2>
                <div class="member-form">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Nombre de la persona:</label>
                        <input type="text" id="memberName" class="member-input" placeholder="Nombre completo">
                    </div>
                    
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Nombre de la empresa:</label>
                        <input type="text" id="memberCompany" class="member-input" placeholder="Nombre de la empresa">
                    </div>
                    
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Peticiones (opcional):</label>
                        <textarea id="memberPetitions" class="member-textarea" placeholder="Peticiones iniciales..."></textarea>
                    </div>

                    <div class="member-buttons">
                        <button class="btn-add" onclick="addNewMember()">‚ûï A√±adir Miembro</button>
                        <button class="btn-clear" onclick="clearMemberForm()">üóëÔ∏è Limpiar</button>
                    </div>
                </div>
            </div>

            <!-- Botones de navegaci√≥n -->
            <div class="admin-footer">
                <button class="btn-home" onclick="goBackHome()">üè† Volver al Inicio</button>
                <button class="btn-logout" onclick="logoutAdmin()">üö™ Cerrar Sesi√≥n</button>
            </div>
        </div>
    </div>

    <!-- Pantalla de Consultar Peticiones -->
    <div id="consultarScreen" class="consultar-screen hidden">
        <div class="consultar-container">
            <!-- Header -->
            <div class="consultar-header">
                <h1>üìã Consultar Peticiones</h1>
                <p>Navega y gestiona los PDFs guardados</p>
            </div>

            <!-- Filtros de B√∫squeda -->
            <div class="search-card">
                <h2>üîç Filtros de B√∫squeda</h2>
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Filtrar por fecha:</label>
                    <select id="dateFilter" class="search-select" onchange="filterPdfs()">
                        <option value="all">Todas las fechas</option>
                        <!-- Las fechas se cargar√°n din√°micamente -->
                    </select>
                </div>
            </div>

            <!-- PDFs Guardados -->
            <div class="pdfs-card">
                <div class="pdfs-header">
                    <h2>üìÑ PDFs Guardados</h2>
                    <div class="pdf-count" id="pdfCount">8 PDF</div>
                </div>

                <!-- Grid de PDFs -->
                <div class="pdfs-grid" id="pdfsGrid">
                    <!-- Los PDFs se cargar√°n din√°micamente aqu√≠ -->
                </div>

                <!-- Paginaci√≥n -->
                <div class="pagination" id="pagination">
                    <button class="pagination-btn" onclick="previousPage()" id="prevBtn">‚Äπ</button>
                    <button class="pagination-btn active" onclick="goToPage(1)">1</button>
                    <button class="pagination-btn" onclick="goToPage(2)">2</button>
                    <button class="pagination-btn" onclick="nextPage()" id="nextBtn">‚Ä∫</button>
                </div>
            </div>

            <!-- Bot√≥n Volver -->
            <div class="consultar-footer">
                <button class="btn-back" onclick="goBackFromConsultar()">‚Üê Volver al Inicio</button>
            </div>
        </div>
    </div>

    <!-- Pantalla de Empezamos -->
    <div id="empezamosScreen" class="empezamos-screen hidden">
        <div class="empezamos-container">
            <!-- Avatar de la persona con papelera (solo admin) -->
            <div style="position: relative; display: flex; align-items: center; justify-content: center; margin-bottom: 30px;">
                <div class="person-avatar">
                    üë§
                </div>
                <!-- Papelera (solo visible para admin) -->
                <button id="deletePersonBtn" class="delete-person-btn hidden" onclick="deleteCurrentPerson()" title="Eliminar persona">
                    üóëÔ∏è
                </button>
            </div>

            <!-- Formulario de la persona -->
            <div class="person-form">
                <div class="person-field">
                    <label class="person-label">Nombre de la persona:</label>
                    <input type="text" id="empezamosPersonName" class="person-input" placeholder="Nueva Persona" onchange="saveCurrentPersonData()" oninput="autoSavePersonData()">
                </div>

                <div class="person-field">
                    <label class="person-label">Nombre de la empresa:</label>
                    <input type="text" id="empezamosPersonCompany" class="person-input" placeholder="Sin empresa" onchange="saveCurrentPersonData()" oninput="autoSavePersonData()">
                </div>

                <div class="person-field">
                    <label class="person-label">Peticiones:</label>
                    <textarea id="empezamosPersonPetitions" class="person-textarea" placeholder="Escribe aqu√≠ las peticiones..." onchange="saveCurrentPersonData()" oninput="autoSavePersonData()"></textarea>
                </div>
            </div>

            <!-- Separador -->
            <div class="person-separator"></div>

            <!-- Navegaci√≥n -->
            <div class="person-navigation">
                <button id="btnAnterior" class="nav-btn btn-anterior" onclick="previousPersonEmpezamos()" disabled>
                    ‚Üê Anterior
                </button>
                <button id="btnSiguiente" class="nav-btn btn-siguiente" onclick="nextPersonEmpezamos()">
                    Siguiente ‚Üí
                </button>
            </div>

            <!-- Contador de persona -->
            <div class="person-counter" id="empezamosPersonCounter">
                Persona 1 de 1
            </div>

            <!-- Bot√≥n volver al inicio -->
            <div class="empezamos-footer">
                <button class="btn-inicio" onclick="goBackFromEmpezamos()">
                    üè† Inicio
                </button>
            </div>
        </div>
    </div>

    <!-- Pantalla Final de Proceso Completado -->
    <div id="finalScreen" class="final-screen hidden">
        <div class="final-container">
            <!-- Header -->
            <div class="final-header">
                <div class="final-title">
                    üéâ ¬°Proceso Completado!
                </div>
                <div class="final-subtitle">
                    Has revisado todas las personas. Ahora puedes descargar el reporte en PDF.
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-number" id="finalTotalPersonas">0</div>
                    <div class="stat-label">Total Personas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="finalConPeticiones">0</div>
                    <div class="stat-label">Con Peticiones</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="finalSinPeticiones">0</div>
                    <div class="stat-label">Sin Peticiones</div>
                </div>
            </div>

            <!-- Opciones de PDF -->
            <div class="pdf-options">
                <h3>üéØ Selecciona qu√© incluir en el PDF:</h3>
                <div class="filter-options">
                    <div class="filter-option selected" data-filter="all" onclick="selectFinalFilter('all')">
                        üë• Todas las Personas
                    </div>
                    <div class="filter-option" data-filter="with-peticiones" onclick="selectFinalFilter('with-peticiones')">
                        üìù Solo con Peticiones
                    </div>
                </div>
                
                <button class="btn-download-final" onclick="generateFinalPdf()">
                    üìä Descargar PDF
                </button>
            </div>

            <!-- Secci√≥n de guardar en base de datos (solo admin) -->
            <div id="adminSaveSection" class="admin-save-section hidden">
                <input type="checkbox" id="saveToConsultasCheckbox" class="admin-checkbox" checked>
                <label for="saveToConsultasCheckbox">üíæ Guardar tambi√©n en la base de datos para consultas futuras</label>
            </div>

            <!-- Navegaci√≥n -->
            <div class="final-navigation">
                <button class="btn-back-final" onclick="goBackToEmpezamos()">
                    ‚Üê Volver Atr√°s
                </button>
                <button class="btn-discard" onclick="discardChanges()">
                    üóëÔ∏è Descartar
                </button>
                <button class="btn-home-final" onclick="goBackHomeFromFinal()">
                    üè† Volver al Inicio
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let isAdminLoggedIn = false;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminStatus();
            loadLogoOnStartup();
            console.log('üéâ GenPeticiones iniciado correctamente');
        });

        // Verificar estado de administrador
        function checkAdminStatus() {
            isAdminLoggedIn = localStorage.getItem('gen_admin_logged') === 'true';
            
            const logoEditBtn = document.getElementById('logoEditBtn');
            const adminIcon = document.getElementById('adminIcon');
            const adminTitle = document.getElementById('adminTitle');
            const adminSubtitle = document.getElementById('adminSubtitle');
            
            if (isAdminLoggedIn) {
                logoEditBtn.classList.remove('hidden');
                adminIcon.textContent = '‚úÖ';
                adminTitle.textContent = 'ADMIN';
                adminSubtitle.textContent = 'CONECTADO';
            } else {
                logoEditBtn.classList.add('hidden');
                adminIcon.textContent = 'üë®‚Äçüíº';
                adminTitle.textContent = 'ACCESO';
                adminSubtitle.textContent = 'ADMINISTRADOR';
            }
        }

        // Mostrar modal de login de administrador
        function showAdminLogin() {
            if (isAdminLoggedIn) {
                showAdminPanel();
                return;
            }
            
            document.getElementById('adminModal').classList.remove('hidden');
            document.getElementById('adminUser').focus();
        }

        // Cerrar modal de administrador
        function closeAdminModal() {
            document.getElementById('adminModal').classList.add('hidden');
            document.getElementById('adminUser').value = '';
            document.getElementById('adminPass').value = '';
        }

        // Manejar login de administrador
        function handleAdminLogin() {
            const user = document.getElementById('adminUser').value;
            const pass = document.getElementById('adminPass').value;
            
            // Credenciales por defecto (personalizables)
            const storedUser = localStorage.getItem('gen_admin_user') || 'admin';
            const storedPassword = localStorage.getItem('gen_admin_password') || '123456';
            
            if (user === storedUser && pass === storedPassword) {
                localStorage.setItem('gen_admin_logged', 'true');
                isAdminLoggedIn = true;
                closeAdminModal();
                checkAdminStatus();
                alert('‚úÖ Sesi√≥n de administrador iniciada correctamente');
            } else {
                alert('‚ùå Usuario o contrase√±a incorrectos');
            }
        }

        // Variables para edici√≥n de logo
        let currentLogoSize = 160; // Altura del c√≠rculo del logo (optimizado para m√≥vil)
        let currentLogoImage = null;
        let hasCustomLogo = false;

        // Editar logo (solo para administradores)
        function editLogo() {
            if (!isAdminLoggedIn) {
                alert('‚ùå Solo los administradores pueden editar el logo');
                return;
            }
            
            // Cargar configuraci√≥n actual del logo
            loadCurrentLogoSettings();
            document.getElementById('logoModal').classList.remove('hidden');
        }

        // Cargar configuraci√≥n actual del logo
        function loadCurrentLogoSettings() {
            const savedSize = localStorage.getItem('gen_logo_size');
            const savedImage = localStorage.getItem('gen_logo_image');
            
            if (savedSize) {
                currentLogoSize = parseInt(savedSize);
                document.getElementById('logoSizeSlider').value = currentLogoSize;
                updateLogoSize(currentLogoSize);
            }
            
            if (savedImage) {
                currentLogoImage = savedImage;
                hasCustomLogo = true;
                updateLogoPreview();
            }
        }

        // Actualizar tama√±o del logo
        function updateLogoSize(size) {
            currentLogoSize = parseInt(size);
            document.getElementById('logoSizeValue').textContent = size + 'px';
            
            const logoPreview = document.getElementById('logoPreview');
            
            // Mantener el ancho completo del contenedor, solo cambiar altura
            logoPreview.style.width = '280px'; // Ancho fijo para mantener proporci√≥n
            logoPreview.style.height = (size + 40) + 'px'; // Altura + padding
            
            // Actualizar el c√≠rculo del logo en la vista previa
            const logoCircle = logoPreview.querySelector('.logo-circle');
            if (logoCircle) {
                logoCircle.style.width = size + 'px';
                logoCircle.style.height = size + 'px';
                
                // Ajustar borde proporcionalmente
                const borderWidth = Math.max(8, Math.round(size * 0.067)); // 12px para 180px
                logoCircle.style.borderWidth = borderWidth + 'px';
                
                // Ajustar barras verdes proporcionalmente
                const barWidth = Math.round(size * 0.44); // 80px para 180px
                const barHeight = Math.max(8, Math.round(size * 0.067)); // 12px para 180px
                const barTop = Math.round(size * 0.167); // 30px para 180px
                
                logoCircle.style.setProperty('--bar-width', barWidth + 'px');
                logoCircle.style.setProperty('--bar-height', barHeight + 'px');
                logoCircle.style.setProperty('--bar-top', barTop + 'px');
            }
            
            // Ajustar tama√±o del texto proporcionalmente
            const logoGen = logoPreview.querySelector('.logo-gen');
            if (logoGen) {
                const fontSize = (size / 160) * 3.1; // Escala basada en el tama√±o original 160px
                logoGen.style.fontSize = fontSize + 'rem';
            }
        }

        // Manejar subida de logo
        function handleLogoUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validar tipo de archivo
            if (!file.type.match(/^image\/(jpeg|jpg|png)$/)) {
                alert('‚ùå Solo se permiten archivos JPG y PNG');
                input.value = '';
                return;
            }
            
            // Validar tama√±o (2MB m√°ximo)
            if (file.size > 2 * 1024 * 1024) {
                alert('‚ùå El archivo es demasiado grande. M√°ximo 2MB');
                input.value = '';
                return;
            }
            
            // Leer archivo como base64
            const reader = new FileReader();
            reader.onload = function(e) {
                currentLogoImage = e.target.result;
                hasCustomLogo = true;
                updateLogoPreview();
                console.log('üìÅ Logo cargado correctamente');
            };
            reader.readAsDataURL(file);
        }

        // Actualizar vista previa del logo
        function updateLogoPreview() {
            const logoPreview = document.getElementById('logoPreview');
            
            if (hasCustomLogo && currentLogoImage) {
                logoPreview.innerHTML = `<img src="${currentLogoImage}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 15px;">`;
            } else {
                // Restaurar logo original con variables CSS
                const borderWidth = Math.max(8, Math.round(currentLogoSize * 0.067));
                const barWidth = Math.round(currentLogoSize * 0.44);
                const barHeight = Math.max(8, Math.round(currentLogoSize * 0.067));
                const barTop = Math.round(currentLogoSize * 0.167);
                const fontSize = (currentLogoSize / 160) * 3.1;
                
                logoPreview.innerHTML = `
                    <div class="logo-container" style="width: 100%; max-width: none;">
                        <div class="logo-circle" style="
                            --logo-size: ${currentLogoSize}px;
                            --logo-border: ${borderWidth}px;
                            --bar-width: ${barWidth}px;
                            --bar-height: ${barHeight}px;
                            --bar-top: ${barTop}px;
                        ">
                            <div class="logo-gen" style="font-size: ${fontSize}rem;">
                                <span class="g">G</span><span class="e">E</span><span class="n">N</span>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Guardar cambios del logo
        function saveLogoChanges() {
            try {
                // Guardar tama√±o
                localStorage.setItem('gen_logo_size', currentLogoSize.toString());
                
                // Guardar imagen si hay una personalizada
                if (hasCustomLogo && currentLogoImage) {
                    localStorage.setItem('gen_logo_image', currentLogoImage);
                    localStorage.setItem('gen_has_custom_logo', 'true');
                } else {
                    localStorage.removeItem('gen_logo_image');
                    localStorage.setItem('gen_has_custom_logo', 'false');
                }
                
                // Aplicar cambios al logo principal
                applyLogoChanges();
                
                // Cerrar modal
                closeLogoModal();
                
                alert('‚úÖ Logo actualizado correctamente');
                console.log('üíæ Configuraci√≥n del logo guardada');
                
            } catch (e) {
                alert('‚ùå Error al guardar los cambios del logo');
                console.error('Error:', e);
            }
        }

        // Aplicar cambios al logo principal
        function applyLogoChanges() {
            const logoSection = document.querySelector('.logo-section');
            const logoContainer = logoSection.querySelector('.logo-container');
            
            // Limitar el tama√±o a valores seguros para m√≥vil
            const maxSafeSize = 160; // Tama√±o m√°ximo seguro
            const safeSize = Math.min(Math.max(currentLogoSize, 120), maxSafeSize);
            
            if (hasCustomLogo && currentLogoImage) {
                // Reemplazar con imagen personalizada manteniendo l√≠mites estrictos
                logoContainer.innerHTML = `
                    <div style="
                        width: ${safeSize}px; 
                        height: ${safeSize}px; 
                        max-width: 100%; 
                        max-height: 100%; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center;
                        margin: 0 auto;
                        overflow: hidden;
                    ">
                        <img src="${currentLogoImage}" style="
                            max-width: 100%; 
                            max-height: 100%; 
                            object-fit: contain;
                            width: auto;
                            height: auto;
                        ">
                    </div>
                `;
            } else {
                // Actualizar logo original con tama√±o controlado
                logoContainer.innerHTML = `
                    <div class="logo-circle" style="
                        --logo-size: ${safeSize}px;
                        --logo-border: ${Math.max(8, Math.round(safeSize * 0.067))}px;
                        --bar-width: ${Math.round(safeSize * 0.44)}px;
                        --bar-height: ${Math.max(8, Math.round(safeSize * 0.067))}px;
                        --bar-top: ${Math.round(safeSize * 0.167)}px;
                        width: ${safeSize}px !important;
                        height: ${safeSize}px !important;
                        max-width: 100% !important;
                        max-height: 100% !important;
                        margin: 0 auto;
                        flex-shrink: 0;
                    ">
                        <div class="logo-gen" style="font-size: ${(safeSize / 160) * 3.1}rem; line-height: 1;">
                            <span class="g">G</span><span class="e">E</span><span class="n">N</span>
                        </div>
                    </div>
                `;
            }
            
            // Asegurar que el bot√≥n de edici√≥n est√© presente
            if (isAdminLoggedIn) {
                let editBtn = logoSection.querySelector('#logoEditBtn');
                if (!editBtn) {
                    editBtn = document.createElement('button');
                    editBtn.id = 'logoEditBtn';
                    editBtn.className = 'logo-edit-btn';
                    editBtn.onclick = editLogo;
                    editBtn.title = 'Editar logo';
                    editBtn.textContent = '‚úèÔ∏è';
                    logoSection.appendChild(editBtn);
                }
            }
        }

        // Restaurar logo original
        function resetLogo() {
            if (confirm('¬øEst√°s seguro de que quieres restaurar el logo original?')) {
                currentLogoImage = null;
                hasCustomLogo = false;
                currentLogoSize = 160;
                
                // Actualizar controles
                document.getElementById('logoSizeSlider').value = 160;
                document.getElementById('logoFileInput').value = '';
                updateLogoSize(160);
                updateLogoPreview();
                
                console.log('üîÑ Logo restaurado a valores originales');
            }
        }

        // Cerrar modal de edici√≥n de logo
        function closeLogoModal() {
            document.getElementById('logoModal').classList.add('hidden');
            document.getElementById('logoFileInput').value = '';
        }

        // Cargar configuraci√≥n del logo al iniciar
        function loadLogoOnStartup() {
            const savedSize = localStorage.getItem('gen_logo_size');
            const savedImage = localStorage.getItem('gen_logo_image');
            const hasCustom = localStorage.getItem('gen_has_custom_logo') === 'true';
            
            if (savedSize) {
                currentLogoSize = parseInt(savedSize);
            }
            
            if (hasCustom && savedImage) {
                currentLogoImage = savedImage;
                hasCustomLogo = true;
                applyLogoChanges();
            }
        }

        // Ir a consultar peticiones
        function goToConsultar() {
            showConsultarScreen();
        }

        // Ir a empezamos
        function goToEmpezamos() {
            showEmpezamosScreen();
        }

        // Cerrar modal con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAdminModal();
            }
        });

        // Cerrar modal al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeAdminModal();
            }
        });

        // ===== FUNCIONES DEL PANEL DE ADMINISTRACI√ìN =====

        // Mostrar panel de administraci√≥n
        function showAdminPanel() {
            document.getElementById('adminPanel').classList.remove('hidden');
            loadAdminData();
        }

        // Cargar datos del administrador
        function loadAdminData() {
            const currentUser = localStorage.getItem('gen_admin_user') || 'admin';
            document.getElementById('adminStatusUser').textContent = currentUser;
            document.getElementById('currentUser').value = currentUser;
        }

        // Cambiar contrase√±a
        function changePassword() {
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            
            if (!currentPass || !newPass || !confirmPass) {
                alert('‚ùå Por favor, completa todos los campos');
                return;
            }
            
            const storedPassword = localStorage.getItem('gen_admin_password') || '123456';
            if (currentPass !== storedPassword) {
                alert('‚ùå La contrase√±a actual es incorrecta');
                return;
            }
            
            if (newPass !== confirmPass) {
                alert('‚ùå Las contrase√±as no coinciden');
                return;
            }
            
            if (newPass.length < 4) {
                alert('‚ùå La contrase√±a debe tener al menos 4 caracteres');
                return;
            }
            
            localStorage.setItem('gen_admin_password', newPass);
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            alert('‚úÖ Contrase√±a cambiada correctamente');
        }

        // Cambiar nombre de usuario
        function changeUsername() {
            const currentPass = document.getElementById('currentPasswordUser').value;
            const newUser = document.getElementById('newUser').value;
            
            if (!currentPass || !newUser) {
                alert('‚ùå Por favor, completa todos los campos');
                return;
            }
            
            const storedPassword = localStorage.getItem('gen_admin_password') || '123456';
            if (currentPass !== storedPassword) {
                alert('‚ùå La contrase√±a actual es incorrecta');
                return;
            }
            
            if (newUser.length < 3) {
                alert('‚ùå El nombre de usuario debe tener al menos 3 caracteres');
                return;
            }
            
            localStorage.setItem('gen_admin_user', newUser);
            document.getElementById('currentPasswordUser').value = '';
            document.getElementById('newUser').value = '';
            document.getElementById('currentUser').value = newUser;
            document.getElementById('adminStatusUser').textContent = newUser;
            
            alert('‚úÖ Nombre de usuario cambiado correctamente');
        }

        // Manejar drag and drop
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleDatabaseUpload({ files: files });
            }
        }

        // Manejar subida de base de datos
        function handleDatabaseUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validar tipo de archivo
            const validTypes = ['text/plain', 'text/csv', 'application/json'];
            if (!validTypes.includes(file.type) && !file.name.match(/\.(txt|csv|json)$/i)) {
                alert('‚ùå Solo se permiten archivos TXT, CSV y JSON');
                return;
            }
            
            // Validar tama√±o (5MB m√°ximo)
            if (file.size > 5 * 1024 * 1024) {
                alert('‚ùå El archivo es demasiado grande. M√°ximo 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const extension = file.name.split('.').pop().toLowerCase();
                    
                    let personas = [];
                    
                    if (extension === 'txt') {
                        personas = parseTxtFile(content);
                    } else if (extension === 'csv') {
                        personas = parseCsvFile(content);
                    } else if (extension === 'json') {
                        personas = parseJsonFile(content);
                    }
                    
                    if (personas.length > 0) {
                        // Sustituir completamente la base de datos anterior
                        localStorage.setItem('gen_personas_data', JSON.stringify(personas));
                        alert(`‚úÖ Base de datos sustituida correctamente: ${personas.length} personas importadas\n\n‚ö†Ô∏è La base de datos anterior ha sido reemplazada completamente.`);
                        console.log('üìä Base de datos sustituida con:', personas);
                    } else {
                        alert('‚ùå No se pudieron importar datos del archivo');
                    }
                    
                } catch (error) {
                    alert('‚ùå Error al procesar el archivo: ' + error.message);
                    console.error('Error:', error);
                }
            };
            reader.readAsText(file);
        }

        // Parsear archivo TXT
        function parseTxtFile(content) {
            const lines = content.split('\n').map(line => line.trim()).filter(line => line);
            const personas = [];
            
            for (let i = 0; i < lines.length; i += 2) {
                if (lines[i] && lines[i + 1]) {
                    personas.push({
                        id: Date.now() + i,
                        nombre: lines[i],
                        empresa: lines[i + 1],
                        peticiones: ''
                    });
                }
            }
            
            return personas;
        }

        // Parsear archivo CSV
        function parseCsvFile(content) {
            const lines = content.split('\n').map(line => line.trim()).filter(line => line);
            const personas = [];
            
            // Saltar la primera l√≠nea si parece ser un header
            const startIndex = lines[0].toLowerCase().includes('nombre') ? 1 : 0;
            
            for (let i = startIndex; i < lines.length; i++) {
                const columns = lines[i].split(',').map(col => col.trim().replace(/"/g, ''));
                if (columns.length >= 2) {
                    personas.push({
                        id: Date.now() + i,
                        nombre: columns[0] || 'Sin nombre',
                        empresa: columns[1] || 'Sin empresa',
                        peticiones: columns[2] || ''
                    });
                }
            }
            
            return personas;
        }

        // Parsear archivo JSON
        function parseJsonFile(content) {
            const data = JSON.parse(content);
            const personas = [];
            
            if (Array.isArray(data)) {
                data.forEach((item, index) => {
                    personas.push({
                        id: Date.now() + index,
                        nombre: item.nombre || item.name || 'Sin nombre',
                        empresa: item.empresa || item.company || 'Sin empresa',
                        peticiones: item.peticiones || item.requests || ''
                    });
                });
            }
            
            return personas;
        }

        // A√±adir nuevo miembro
        function addNewMember() {
            const name = document.getElementById('memberName').value.trim();
            const company = document.getElementById('memberCompany').value.trim();
            const petitions = document.getElementById('memberPetitions').value.trim();
            
            if (!name || !company) {
                alert('‚ùå Por favor, completa al menos el nombre y la empresa');
                return;
            }
            
            // Cargar personas existentes
            let personas = [];
            try {
                const saved = localStorage.getItem('gen_personas_data');
                if (saved) {
                    personas = JSON.parse(saved);
                }
            } catch (e) {
                personas = [];
            }
            
            // A√±adir nuevo miembro
            const newMember = {
                id: Date.now(),
                nombre: name,
                empresa: company,
                peticiones: petitions
            };
            
            personas.push(newMember);
            
            // Guardar en localStorage
            localStorage.setItem('gen_personas_data', JSON.stringify(personas));
            
            // Limpiar formulario
            clearMemberForm();
            
            alert(`‚úÖ Miembro a√±adido correctamente: ${name}`);
            console.log('üë• Nuevo miembro a√±adido:', newMember);
        }

        // Limpiar formulario de miembro
        function clearMemberForm() {
            document.getElementById('memberName').value = '';
            document.getElementById('memberCompany').value = '';
            document.getElementById('memberPetitions').value = '';
        }

        // Volver al inicio
        function goBackHome() {
            document.getElementById('adminPanel').classList.add('hidden');
        }

        // Cerrar sesi√≥n de administrador
        function logoutAdmin() {
            if (confirm('¬øEst√°s seguro de que quieres cerrar la sesi√≥n de administrador?')) {
                localStorage.setItem('gen_admin_logged', 'false');
                isAdminLoggedIn = false;
                document.getElementById('adminPanel').classList.add('hidden');
                checkAdminStatus();
                alert('‚úÖ Sesi√≥n de administrador cerrada');
            }
        }

        // ===== FUNCIONES DE CONSULTAR PETICIONES =====

        // Variables para consultar peticiones
        let allPdfs = [];
        let filteredPdfs = [];
        let currentPage = 1;
        const pdfsPerPage = 6; // Aumentamos a 6 ya que ahora es una columna

        // Mostrar pantalla de consultar peticiones
        function showConsultarScreen() {
            document.getElementById('consultarScreen').classList.remove('hidden');
            initializePdfs();
            loadPdfs();
            
            // Si no hay PDFs, mostrar mensaje informativo
            if (allPdfs.length === 0) {
                showNoPdfsMessage();
            }
        }

        // Mostrar mensaje cuando no hay PDFs
        function showNoPdfsMessage() {
            const grid = document.getElementById('pdfsGrid');
            grid.innerHTML = `
                <div style="text-align: center; padding: 40px 20px; color: #666;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">üìÑ</div>
                    <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: #333;">No hay PDFs guardados</h3>
                    <p style="font-size: 0.9rem; line-height: 1.5;">Los PDFs que generes desde "Empezamos" aparecer√°n aqu√≠ para consulta y descarga.</p>
                    <div style="margin-top: 20px;">
                        <button onclick="goBackFromConsultar()" style="background: #A4C639; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer;">
                            ‚≠ê Ir a Empezamos
                        </button>
                    </div>
                </div>
            `;
        }

        // Inicializar PDFs (solo los realmente guardados)
        function initializePdfs() {
            // Cargar solo PDFs realmente guardados desde localStorage
            const savedPdfs = localStorage.getItem('gen_saved_pdfs');
            if (savedPdfs) {
                try {
                    allPdfs = JSON.parse(savedPdfs);
                    console.log('üìä PDFs cargados desde localStorage:', allPdfs.length);
                } catch (e) {
                    console.log('Error cargando PDFs guardados:', e);
                    allPdfs = [];
                }
            } else {
                allPdfs = [];
                console.log('üìä No hay PDFs guardados - empezando con lista vac√≠a');
            }

            filteredPdfs = [...allPdfs];
        }

        // Cargar y mostrar PDFs
        function loadPdfs() {
            updateDateFilter();
            updatePdfCount();
            displayPdfs();
            updatePagination();
        }

        // Actualizar filtro de fechas din√°micamente
        function updateDateFilter() {
            const dateFilter = document.getElementById('dateFilter');
            const currentValue = dateFilter.value;
            
            // Obtener fechas √∫nicas de todos los PDFs
            const uniqueDates = [...new Set(allPdfs.map(pdf => pdf.date))].sort().reverse();
            
            // Limpiar opciones existentes
            dateFilter.innerHTML = '<option value="all">Todas las fechas</option>';
            
            // A√±adir opciones din√°micamente
            uniqueDates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = new Date(date).toLocaleDateString('es-ES', { 
                    day: '2-digit', 
                    month: 'long', 
                    year: 'numeric' 
                });
                dateFilter.appendChild(option);
            });
            
            // Restaurar valor seleccionado si existe
            if (currentValue && uniqueDates.includes(currentValue)) {
                dateFilter.value = currentValue;
            }
        }

        // Actualizar contador de PDFs
        function updatePdfCount() {
            document.getElementById('pdfCount').textContent = `${filteredPdfs.length} PDF${filteredPdfs.length !== 1 ? 's' : ''}`;
        }

        // Mostrar PDFs en la p√°gina actual
        function displayPdfs() {
            const startIndex = (currentPage - 1) * pdfsPerPage;
            const endIndex = startIndex + pdfsPerPage;
            const pdfsToShow = filteredPdfs.slice(startIndex, endIndex);

            const grid = document.getElementById('pdfsGrid');
            grid.innerHTML = '';

            pdfsToShow.forEach(pdf => {
                const pdfElement = document.createElement('div');
                pdfElement.className = 'pdf-item';
                pdfElement.innerHTML = `
                    <div class="pdf-name">${pdf.name}</div>
                    <div class="pdf-date">${pdf.formattedDate}</div>
                    <div class="pdf-info">
                        <strong>Tipo:</strong> ${pdf.type}<br>
                        <strong>Registros:</strong> ${pdf.records}<br>
                        <strong>Tama√±o:</strong> ${pdf.size}
                    </div>
                    <div class="pdf-buttons">
                        <button class="btn-download" onclick="downloadPdf('${pdf.id}')">üì• Descargar</button>
                        ${isAdminLoggedIn ? `<button class="btn-delete" onclick="deletePdf('${pdf.id}')">üóëÔ∏è Eliminar</button>` : ''}
                    </div>
                `;
                grid.appendChild(pdfElement);
            });
        }

        // Filtrar PDFs por fecha
        function filterPdfs() {
            const selectedDate = document.getElementById('dateFilter').value;
            
            if (selectedDate === 'all') {
                filteredPdfs = [...allPdfs];
            } else {
                filteredPdfs = allPdfs.filter(pdf => pdf.date === selectedDate);
            }

            currentPage = 1;
            loadPdfs();
        }

        // Actualizar paginaci√≥n
        function updatePagination() {
            const totalPages = Math.ceil(filteredPdfs.length / pdfsPerPage);
            const pagination = document.getElementById('pagination');
            
            pagination.innerHTML = '';

            // Bot√≥n anterior
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.innerHTML = '‚Äπ';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = previousPage;
            pagination.appendChild(prevBtn);

            // Botones de p√°gina
            for (let i = 1; i <= Math.min(totalPages, 3); i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.innerHTML = i;
                pageBtn.onclick = () => goToPage(i);
                pagination.appendChild(pageBtn);
            }

            // Bot√≥n siguiente
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.innerHTML = '‚Ä∫';
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
            nextBtn.onclick = nextPage;
            pagination.appendChild(nextBtn);
        }

        // Navegaci√≥n de p√°ginas
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                displayPdfs();
                updatePagination();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredPdfs.length / pdfsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayPdfs();
                updatePagination();
            }
        }

        function goToPage(page) {
            currentPage = page;
            displayPdfs();
            updatePagination();
        }

        // Descargar PDF
        function downloadPdf(pdfId) {
            const pdf = allPdfs.find(p => p.id == pdfId);
            if (!pdf) {
                alert('‚ùå PDF no encontrado');
                return;
            }

            // Generar contenido del PDF basado en los datos guardados
            let personas = [];
            try {
                const saved = localStorage.getItem('gen_personas_data');
                if (saved) {
                    personas = JSON.parse(saved);
                }
            } catch (e) {
                personas = [];
            }

            // Si no hay personas, crear datos de muestra
            if (personas.length === 0) {
                personas = [
                    { nombre: 'Juan P√©rez', empresa: 'Tech Solutions', peticiones: 'Mejoras en el sistema de facturaci√≥n' },
                    { nombre: 'Mar√≠a Garc√≠a', empresa: 'Innovate Corp', peticiones: 'Implementar nuevas funcionalidades' },
                    { nombre: 'Carlos L√≥pez', empresa: 'Digital Works', peticiones: 'Optimizaci√≥n de procesos' },
                    { nombre: 'Ana Mart√≠nez', empresa: 'Creative Agency', peticiones: 'Dise√±o de nueva interfaz' },
                    { nombre: 'Pedro Rodr√≠guez', empresa: 'Data Systems', peticiones: 'An√°lisis de datos avanzado' }
                ];
            }

            try {
                // Crear nuevo documento PDF usando jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Configurar fuente y colores
                doc.setFont('helvetica');
                
                // Header del documento
                doc.setFontSize(20);
                doc.setTextColor(114, 47, 55); // Color granate
                doc.text('REPORTE DE PETICIONES', 20, 25);
                
                doc.setFontSize(14);
                doc.setTextColor(164, 198, 57); // Color verde
                doc.text(pdf.type.toUpperCase(), 20, 35);
                
                // Informaci√≥n del reporte
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Generado: ${pdf.formattedDate}`, 20, 50);
                doc.text(`Archivo: ${pdf.name}`, 20, 55);
                
                // L√≠nea separadora
                doc.setDrawColor(164, 198, 57);
                doc.setLineWidth(1);
                doc.line(20, 65, 190, 65);
                
                // Estad√≠sticas
                doc.setFontSize(12);
                doc.setTextColor(114, 47, 55);
                doc.text('ESTADISTICAS:', 20, 80);
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`‚Ä¢ Total de registros: ${pdf.records}`, 25, 90);
                doc.text(`‚Ä¢ Tipo de reporte: ${pdf.type}`, 25, 95);
                doc.text(`‚Ä¢ Tama√±o del archivo: ${pdf.size}`, 25, 100);
                
                // Detalle de personas
                doc.setFontSize(12);
                doc.setTextColor(114, 47, 55);
                doc.text('DETALLE DE PERSONAS:', 20, 115);
                
                // Tomar una muestra de personas seg√∫n el tipo de reporte
                let sampleSize = Math.min(personas.length, Math.floor(pdf.records / 10));
                if (sampleSize === 0) sampleSize = Math.min(personas.length, 5);
                
                let yPosition = 125;
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                
                for (let i = 0; i < sampleSize && yPosition < 250; i++) {
                    const person = personas[i % personas.length];
                    
                    // Verificar si necesitamos una nueva p√°gina
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Nombre (en negrita)
                    doc.setFont('helvetica', 'bold');
                    doc.text(`${i + 1}. ${person.nombre}`, 25, yPosition);
                    yPosition += 5;
                    
                    // Empresa
                    doc.setFont('helvetica', 'normal');
                    doc.text(`   Empresa: ${person.empresa}`, 25, yPosition);
                    yPosition += 5;
                    
                    // Peticiones (si aplica seg√∫n el tipo de reporte)
                    if (pdf.type !== 'Solo Empresas') {
                        const peticiones = person.peticiones || 'Sin peticiones espec√≠ficas';
                        // Dividir texto largo en m√∫ltiples l√≠neas
                        const lines = doc.splitTextToSize(`   Peticiones: ${peticiones}`, 160);
                        doc.text(lines, 25, yPosition);
                        yPosition += lines.length * 5;
                    }
                    
                    yPosition += 3; // Espacio entre personas
                }
                
                // Resumen al final
                if (yPosition > 240) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(12);
                doc.setTextColor(114, 47, 55);
                doc.text('RESUMEN:', 20, yPosition + 10);
                
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                const resumenText = `Este reporte contiene ${sampleSize} registros de muestra del total de ${pdf.records} registros disponibles.`;
                const resumenLines = doc.splitTextToSize(resumenText, 160);
                doc.text(resumenLines, 20, yPosition + 20);
                
                doc.text('Generado por GenPeticiones - Sistema de Gesti√≥n de Peticiones', 20, yPosition + 30);
                
                // Footer con fecha y hora
                const now = new Date();
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.text(`Generado el ${now.toLocaleString('es-ES')}`, 20, 285);
                
                // Descargar el PDF
                doc.save(`${pdf.name}.pdf`);
                
                alert(`‚úÖ PDF descargado: ${pdf.name}.pdf`);
                console.log('üì• PDF descargado:', pdf.name);

            } catch (e) {
                alert('‚ùå Error al generar el PDF: ' + e.message);
                console.error('Error:', e);
            }
        }

        // Eliminar PDF (solo admin)
        function deletePdf(pdfId) {
            if (!isAdminLoggedIn) {
                alert('‚ùå Solo los administradores pueden eliminar PDFs');
                return;
            }

            const pdf = allPdfs.find(p => p.id == pdfId);
            if (!pdf) {
                alert('‚ùå PDF no encontrado');
                return;
            }

            if (confirm(`¬øEst√°s seguro de que quieres eliminar "${pdf.name}"?`)) {
                // Eliminar de todas las listas
                allPdfs = allPdfs.filter(p => p.id != pdfId);
                filteredPdfs = filteredPdfs.filter(p => p.id != pdfId);

                // Actualizar localStorage con todos los PDFs restantes
                localStorage.setItem('gen_saved_pdfs', JSON.stringify(allPdfs));

                // Recargar vista
                loadPdfs();
                
                alert(`‚úÖ PDF eliminado: ${pdf.name}`);
                console.log('üóëÔ∏è PDF eliminado:', pdf.name);
            }
        }

        // Volver al inicio desde consultar
        function goBackFromConsultar() {
            document.getElementById('consultarScreen').classList.add('hidden');
        }

        // ===== FUNCIONES DE EMPEZAMOS =====

        // Variables para empezamos
        let empezamosPersonas = [];
        let currentEmpezamosIndex = 0;

        // Mostrar pantalla de empezamos
        function showEmpezamosScreen() {
            document.getElementById('empezamosScreen').classList.remove('hidden');
            // Crear backup de la base de datos original antes de empezar
            createDataBackup();
            loadEmpezamosPersonas();
            updateEmpezamosDisplay();
        }

        // Crear backup de la base de datos original
        function createDataBackup() {
            const currentData = localStorage.getItem('gen_personas_data');
            if (currentData) {
                localStorage.setItem('gen_personas_data_backup', currentData);
                console.log('üíæ Backup de datos creado antes de empezar');
            }
        }

        // Cargar personas para empezamos
        function loadEmpezamosPersonas() {
            try {
                const saved = localStorage.getItem('gen_personas_data');
                if (saved) {
                    empezamosPersonas = JSON.parse(saved);
                }
            } catch (e) {
                empezamosPersonas = [];
            }

            // Si no hay personas, crear una por defecto
            if (!empezamosPersonas || empezamosPersonas.length === 0) {
                empezamosPersonas = [{
                    id: Date.now(),
                    nombre: 'Nueva Persona',
                    empresa: 'Sin empresa',
                    peticiones: ''
                }];
                saveEmpezamosPersonas();
            }

            currentEmpezamosIndex = 0;
        }

        // Guardar personas de empezamos
        function saveEmpezamosPersonas() {
            try {
                localStorage.setItem('gen_personas_data', JSON.stringify(empezamosPersonas));
                console.log('üíæ Personas de empezamos guardadas:', empezamosPersonas.length);
            } catch (e) {
                alert('‚ùå Error al guardar datos');
            }
        }

        // Variables para autoguardado
        let autoSaveTimeout = null;
        let hasUnsavedChanges = false;

        // Guardar datos de la persona actual
        function saveCurrentPersonData() {
            if (empezamosPersonas[currentEmpezamosIndex]) {
                empezamosPersonas[currentEmpezamosIndex].nombre = document.getElementById('empezamosPersonName').value || 'Nueva Persona';
                empezamosPersonas[currentEmpezamosIndex].empresa = document.getElementById('empezamosPersonCompany').value || 'Sin empresa';
                empezamosPersonas[currentEmpezamosIndex].peticiones = document.getElementById('empezamosPersonPetitions').value || '';
                saveEmpezamosPersonas();
                hasUnsavedChanges = false;
            }
        }

        // Autoguardado en tiempo real (con debounce)
        function autoSavePersonData() {
            hasUnsavedChanges = true;
            
            // Limpiar timeout anterior
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            
            // Guardar despu√©s de 1 segundo de inactividad
            autoSaveTimeout = setTimeout(() => {
                saveCurrentPersonData();
                showAutoSaveIndicator();
            }, 1000);
        }

        // Mostrar indicador de autoguardado
        function showAutoSaveIndicator() {
            // Crear elemento de indicador
            const indicator = document.createElement('div');
            indicator.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 8px 12px;
                border-radius: 8px;
                font-size: 12px;
                font-weight: 600;
                z-index: 3000;
                box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            indicator.innerHTML = 'üíæ Guardado autom√°ticamente';
            
            document.body.appendChild(indicator);
            
            // Animar entrada
            setTimeout(() => {
                indicator.style.opacity = '1';
            }, 100);
            
            // Animar salida y eliminar
            setTimeout(() => {
                indicator.style.opacity = '0';
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 300);
            }, 2000);
        }

        // Actualizar visualizaci√≥n de empezamos
        function updateEmpezamosDisplay() {
            if (empezamosPersonas[currentEmpezamosIndex]) {
                const person = empezamosPersonas[currentEmpezamosIndex];
                document.getElementById('empezamosPersonName').value = person.nombre || 'Nueva Persona';
                document.getElementById('empezamosPersonCompany').value = person.empresa || 'Sin empresa';
                document.getElementById('empezamosPersonPetitions').value = person.peticiones || '';
                document.getElementById('empezamosPersonCounter').textContent = `Persona ${currentEmpezamosIndex + 1} de ${empezamosPersonas.length}`;

                // Mostrar/ocultar bot√≥n de eliminar seg√∫n permisos de admin
                const deleteBtn = document.getElementById('deletePersonBtn');
                if (isAdminLoggedIn && empezamosPersonas.length > 1) {
                    deleteBtn.classList.remove('hidden');
                } else {
                    deleteBtn.classList.add('hidden');
                }

                // Actualizar botones de navegaci√≥n
                const btnAnterior = document.getElementById('btnAnterior');
                const btnSiguiente = document.getElementById('btnSiguiente');
                
                btnAnterior.disabled = currentEmpezamosIndex === 0;
                
                if (currentEmpezamosIndex === empezamosPersonas.length - 1) {
                    btnSiguiente.innerHTML = 'Finalizar ‚Üí';
                    btnSiguiente.classList.add('finalizar');
                } else {
                    btnSiguiente.innerHTML = 'Siguiente ‚Üí';
                    btnSiguiente.classList.remove('finalizar');
                }
            }
        }

        // Navegaci√≥n anterior en empezamos
        function previousPersonEmpezamos() {
            if (currentEmpezamosIndex > 0) {
                saveCurrentPersonData();
                currentEmpezamosIndex--;
                updateEmpezamosDisplay();
            }
        }

        // Navegaci√≥n siguiente en empezamos
        function nextPersonEmpezamos() {
            // Guardar autom√°ticamente antes de continuar
            saveCurrentPersonData();
            
            // Mostrar confirmaci√≥n visual de guardado
            showSaveConfirmation();
            
            if (currentEmpezamosIndex < empezamosPersonas.length - 1) {
                currentEmpezamosIndex++;
                updateEmpezamosDisplay();
            } else {
                // Finalizar - mostrar pantalla de resumen
                showEmpezamosFinalScreen();
            }
        }

        // Mostrar confirmaci√≥n visual de guardado
        function showSaveConfirmation() {
            // Crear elemento de confirmaci√≥n
            const confirmation = document.createElement('div');
            confirmation.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 10px 15px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 600;
                z-index: 3000;
                box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            confirmation.innerHTML = '‚úÖ Datos guardados autom√°ticamente';
            
            document.body.appendChild(confirmation);
            
            // Animar entrada
            setTimeout(() => {
                confirmation.style.transform = 'translateX(0)';
            }, 100);
            
            // Animar salida y eliminar
            setTimeout(() => {
                confirmation.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (confirmation.parentNode) {
                        confirmation.parentNode.removeChild(confirmation);
                    }
                }, 300);
            }, 2000);
        }

        // Mostrar pantalla final de empezamos
        function showEmpezamosFinalScreen() {
            document.getElementById('empezamosScreen').classList.add('hidden');
            document.getElementById('finalScreen').classList.remove('hidden');
            updateFinalScreenStats();
        }

        // Eliminar persona actual (solo admin)
        function deleteCurrentPerson() {
            if (!isAdminLoggedIn) {
                alert('‚ùå Solo los administradores pueden eliminar personas');
                return;
            }

            if (empezamosPersonas.length <= 1) {
                alert('‚ùå No se puede eliminar la √∫ltima persona. Debe haber al menos una persona en la base de datos.');
                return;
            }

            const currentPerson = empezamosPersonas[currentEmpezamosIndex];
            const personName = currentPerson.nombre || 'Nueva Persona';

            if (confirm(`¬øEst√°s seguro de que quieres eliminar a "${personName}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                // Eliminar la persona del array
                empezamosPersonas.splice(currentEmpezamosIndex, 1);
                
                // Ajustar el √≠ndice actual si es necesario
                if (currentEmpezamosIndex >= empezamosPersonas.length) {
                    currentEmpezamosIndex = empezamosPersonas.length - 1;
                }
                
                // Guardar cambios
                saveEmpezamosPersonas();
                
                // Actualizar la visualizaci√≥n
                updateEmpezamosDisplay();
                
                alert(`‚úÖ Persona eliminada: ${personName}\n\nQuedan ${empezamosPersonas.length} personas en la base de datos.`);
                console.log('üóëÔ∏è Persona eliminada:', personName);
            }
        }

        // Volver al inicio desde empezamos
        function goBackFromEmpezamos() {
            document.getElementById('empezamosScreen').classList.add('hidden');
        }

        // ===== FUNCIONES DE PANTALLA FINAL =====

        // Variables para pantalla final
        let selectedFinalFilter = 'all';

        // Actualizar estad√≠sticas de la pantalla final
        function updateFinalScreenStats() {
            const totalPersonas = empezamosPersonas.length;
            const conPeticiones = empezamosPersonas.filter(p => p.peticiones && p.peticiones.trim()).length;
            const sinPeticiones = totalPersonas - conPeticiones;

            document.getElementById('finalTotalPersonas').textContent = totalPersonas;
            document.getElementById('finalConPeticiones').textContent = conPeticiones;
            document.getElementById('finalSinPeticiones').textContent = sinPeticiones;

            // Mostrar/ocultar secci√≥n de admin
            const adminSection = document.getElementById('adminSaveSection');
            if (isAdminLoggedIn) {
                adminSection.classList.remove('hidden');
            } else {
                adminSection.classList.add('hidden');
            }
        }

        // Seleccionar filtro para PDF final
        function selectFinalFilter(filter) {
            selectedFinalFilter = filter;
            document.querySelectorAll('.filter-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-filter="${filter}"]`).classList.add('selected');
        }

        // Generar PDF final
        function generateFinalPdf() {
            let dataToInclude = empezamosPersonas;
            let reportType = 'Reporte Completo';

            if (selectedFinalFilter === 'with-peticiones') {
                dataToInclude = empezamosPersonas.filter(p => p.peticiones && p.peticiones.trim());
                reportType = 'Solo con Peticiones';
            }

            if (dataToInclude.length === 0) {
                alert('‚ùå No hay datos para generar el reporte con el filtro seleccionado');
                return;
            }

            try {
                // Crear nuevo documento PDF usando jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Configurar fuente y colores
                doc.setFont('helvetica');
                
                // Header del documento
                doc.setFontSize(20);
                doc.setTextColor(114, 47, 55); // Color granate
                doc.text('PROCESO COMPLETADO', 20, 25);
                
                doc.setFontSize(14);
                doc.setTextColor(164, 198, 57); // Color verde
                doc.text(reportType.toUpperCase(), 20, 35);
                
                // Informaci√≥n del reporte
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`Generado: ${new Date().toLocaleDateString('es-ES')}`, 20, 50);
                doc.text(`Total de personas procesadas: ${empezamosPersonas.length}`, 20, 55);
                doc.text(`Incluidas en este reporte: ${dataToInclude.length}`, 20, 60);
                
                // L√≠nea separadora
                doc.setDrawColor(164, 198, 57);
                doc.setLineWidth(1);
                doc.line(20, 70, 190, 70);
                
                // Estad√≠sticas
                doc.setFontSize(12);
                doc.setTextColor(114, 47, 55);
                doc.text('ESTADISTICAS GENERALES:', 20, 85);
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                const totalPersonas = empezamosPersonas.length;
                const conPeticiones = empezamosPersonas.filter(p => p.peticiones && p.peticiones.trim()).length;
                const sinPeticiones = totalPersonas - conPeticiones;
                
                doc.text(`‚Ä¢ Total de personas: ${totalPersonas}`, 25, 95);
                doc.text(`‚Ä¢ Con peticiones: ${conPeticiones}`, 25, 100);
                doc.text(`‚Ä¢ Sin peticiones: ${sinPeticiones}`, 25, 105);
                
                // Detalle de personas
                doc.setFontSize(12);
                doc.setTextColor(114, 47, 55);
                doc.text('DETALLE DE PERSONAS:', 20, 120);
                
                let yPosition = 130;
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                
                dataToInclude.forEach((person, index) => {
                    // Verificar si necesitamos una nueva p√°gina
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Nombre (en negrita)
                    doc.setFont('helvetica', 'bold');
                    doc.text(`${index + 1}. ${person.nombre}`, 25, yPosition);
                    yPosition += 5;
                    
                    // Empresa
                    doc.setFont('helvetica', 'normal');
                    doc.text(`   Empresa: ${person.empresa}`, 25, yPosition);
                    yPosition += 5;
                    
                    // Peticiones
                    if (person.peticiones && person.peticiones.trim()) {
                        const peticiones = person.peticiones;
                        const lines = doc.splitTextToSize(`   Peticiones: ${peticiones}`, 160);
                        doc.text(lines, 25, yPosition);
                        yPosition += lines.length * 5;
                    } else {
                        doc.text('   Peticiones: Sin peticiones espec√≠ficas', 25, yPosition);
                        yPosition += 5;
                    }
                    
                    yPosition += 3; // Espacio entre personas
                });
                
                // Resumen al final
                if (yPosition > 240) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(12);
                doc.setTextColor(114, 47, 55);
                doc.text('RESUMEN DEL PROCESO:', 20, yPosition + 10);
                
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                const resumenText = `Se ha completado exitosamente el proceso de revisi√≥n de ${totalPersonas} personas. Este reporte incluye ${dataToInclude.length} registros seg√∫n el filtro "${reportType}".`;
                const resumenLines = doc.splitTextToSize(resumenText, 160);
                doc.text(resumenLines, 20, yPosition + 20);
                
                doc.text('Generado por GenPeticiones - Sistema de Gesti√≥n de Peticiones', 20, yPosition + 35);
                
                // Footer con fecha y hora
                const now = new Date();
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.text(`Proceso completado el ${now.toLocaleString('es-ES')}`, 20, 285);
                
                // Descargar el PDF
                const fileName = `Proceso_Completado_${reportType.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                // Guardar en consultas si est√° marcado el checkbox y es admin
                if (isAdminLoggedIn && document.getElementById('saveToConsultasCheckbox').checked) {
                    saveFinalPdfToConsultas(reportType, dataToInclude.length);
                }
                
                alert(`‚úÖ PDF generado y descargado: ${fileName}`);
                console.log('üìä PDF final generado:', fileName);

            } catch (e) {
                alert('‚ùå Error al generar el PDF: ' + e.message);
                console.error('Error:', e);
            }
        }

        // Guardar PDF final en consultas
        function saveFinalPdfToConsultas(reportType, recordCount) {
            const savedPdfs = JSON.parse(localStorage.getItem('gen_saved_pdfs') || '[]');
            const newPdf = {
                id: Date.now(),
                name: `Proceso_Completado_${reportType.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}`,
                date: new Date().toISOString().split('T')[0],
                formattedDate: new Date().toLocaleDateString('es-ES', { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric' 
                }),
                type: reportType,
                records: recordCount,
                size: Math.round(Math.random() * 200 + 150) + ' KB',
                description: `${reportType} generado desde proceso completado`
            };

            savedPdfs.unshift(newPdf); // A√±adir al principio
            localStorage.setItem('gen_saved_pdfs', JSON.stringify(savedPdfs));
            console.log('üíæ PDF guardado en consultas:', newPdf.name);
        }

        // Volver a empezamos desde pantalla final
        function goBackToEmpezamos() {
            document.getElementById('finalScreen').classList.add('hidden');
            document.getElementById('empezamosScreen').classList.remove('hidden');
        }

        // Descartar cambios realizados
        function discardChanges() {
            if (confirm('¬øEst√°s seguro de que quieres descartar todas las peticiones?\n\nEsto borrar√° √∫nicamente el contenido de todas las casillas de "Peticiones", manteniendo los nombres y empresas.\n\nEsta acci√≥n no se puede deshacer.')) {
                
                // Limpiar solo las peticiones de todas las personas
                empezamosPersonas.forEach(persona => {
                    persona.peticiones = '';
                });
                
                // Guardar los cambios
                saveEmpezamosPersonas();
                
                // Actualizar estad√≠sticas en la pantalla final
                updateFinalScreenStats();
                
                // Mostrar confirmaci√≥n
                alert('‚úÖ Peticiones descartadas correctamente.\n\nSe han borrado todas las peticiones pero se mantienen los nombres y empresas de las personas.');
                
                console.log('üóëÔ∏è Peticiones descartadas - nombres y empresas mantenidos');
            }
        }

        // Volver al inicio desde pantalla final
        function goBackHomeFromFinal() {
            document.getElementById('finalScreen').classList.add('hidden');
        }

        // ===== SISTEMA DE RECUPERACI√ìN DE CREDENCIALES =====

        // Mostrar opciones de recuperaci√≥n
        function showRecoveryOptions() {
            document.getElementById('adminModal').classList.add('hidden');
            document.getElementById('recoveryModal').classList.remove('hidden');
        }

        // Cerrar modal de recuperaci√≥n
        function closeRecoveryModal() {
            document.getElementById('recoveryModal').classList.add('hidden');
            document.getElementById('recoveryContent').style.display = 'none';
            // Limpiar selecciones
            document.querySelectorAll('.recovery-option div').forEach(option => {
                option.style.borderColor = '#e0e0e0';
                option.style.background = 'white';
            });
        }

        // Seleccionar m√©todo de recuperaci√≥n
        function selectRecoveryMethod(method) {
            // Limpiar selecciones anteriores
            document.querySelectorAll('.recovery-option div').forEach(option => {
                option.style.borderColor = '#e0e0e0';
                option.style.background = 'white';
            });

            // Marcar opci√≥n seleccionada
            const selectedOption = document.getElementById(method + 'Option');
            selectedOption.style.borderColor = '#667eea';
            selectedOption.style.background = '#f8f9ff';

            // Mostrar contenido espec√≠fico
            showRecoveryContent(method);
        }

        // Mostrar contenido de recuperaci√≥n espec√≠fico
        function showRecoveryContent(method) {
            const content = document.getElementById('recoveryContent');
            content.style.display = 'block';

            switch(method) {
                case 'email':
                    content.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">üìß Email de recuperaci√≥n:</label>
                            <input type="email" id="recoveryEmail" placeholder="tu@email.com" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px;">
                        </div>
                        <button onclick="sendRecoveryEmail()" style="width: 100%; background: #667eea; color: white; border: none; padding: 12px 20px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
                            üì§ Enviar Credenciales
                        </button>
                    `;
                    break;

                case 'pattern':
                    content.innerHTML = `
                        <div style="text-align: center; margin-bottom: 20px;">
                            <p style="margin-bottom: 15px; color: #666;">Dibuja tu patr√≥n de desbloqueo:</p>
                            <div id="patternGrid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 200px; margin: 0 auto;">
                                ${Array.from({length: 9}, (_, i) => 
                                    `<div class="pattern-dot" data-index="${i}" onclick="togglePatternDot(${i})" style="width: 50px; height: 50px; border: 3px solid #e0e0e0; border-radius: 50%; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;"></div>`
                                ).join('')}
                            </div>
                        </div>
                        <button onclick="verifyPattern()" style="width: 100%; background: #667eea; color: white; border: none; padding: 12px 20px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
                            üîì Verificar Patr√≥n
                        </button>
                    `;
                    break;

                case 'fingerprint':
                    content.innerHTML = `
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 4rem; margin-bottom: 15px;">üëÜ</div>
                            <p style="color: #666; margin-bottom: 15px;">Coloca tu dedo en el sensor</p>
                            <div id="fingerprintStatus" style="padding: 15px; background: #f8f9fa; border-radius: 10px; color: #666;">
                                Esperando huella dactilar...
                            </div>
                        </div>
                        <button onclick="simulateFingerprint()" style="width: 100%; background: #667eea; color: white; border: none; padding: 12px 20px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
                            üëÜ Usar Huella Dactilar
                        </button>
                    `;
                    break;

                case 'question':
                    const questions = [
                        "¬øCu√°l es el nombre de tu primera mascota?",
                        "¬øEn qu√© ciudad naciste?",
                        "¬øCu√°l es tu comida favorita?",
                        "¬øC√≥mo se llama tu mejor amigo de la infancia?"
                    ];
                    const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
                    
                    content.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">‚ùì Pregunta de seguridad:</label>
                            <div style="padding: 12px 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 15px; color: #666;">
                                ${randomQuestion}
                            </div>
                            <input type="text" id="securityAnswer" placeholder="Tu respuesta..." style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px;">
                        </div>
                        <button onclick="verifySecurityAnswer()" style="width: 100%; background: #667eea; color: white; border: none; padding: 12px 20px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
                            ‚úÖ Verificar Respuesta
                        </button>
                    `;
                    break;
            }
        }

        // Variables para el patr√≥n
        let selectedPattern = [];
        let savedPattern = [0, 1, 2, 4, 8]; // Patr√≥n por defecto: L invertida

        // Alternar punto del patr√≥n
        function togglePatternDot(index) {
            const dot = document.querySelector(`[data-index="${index}"]`);
            const isSelected = selectedPattern.includes(index);
            
            if (isSelected) {
                selectedPattern = selectedPattern.filter(i => i !== index);
                dot.style.background = 'white';
                dot.style.borderColor = '#e0e0e0';
                dot.textContent = '';
            } else {
                selectedPattern.push(index);
                dot.style.background = '#667eea';
                dot.style.borderColor = '#667eea';
                dot.style.color = 'white';
                dot.textContent = selectedPattern.length;
            }
        }

        // Funciones de recuperaci√≥n
        function sendRecoveryEmail() {
            const email = document.getElementById('recoveryEmail').value;
            if (!email) {
                alert('‚ùå Por favor, ingresa tu email');
                return;
            }
            
            // Simular env√≠o de email
            setTimeout(() => {
                alert(`‚úÖ Credenciales enviadas a ${email}\n\nüìß Usuario: admin\nüîë Contrase√±a: 123456\n\n(En un sistema real, esto se enviar√≠a por email)`);
                closeRecoveryModal();
            }, 1500);
            
            document.getElementById('recoveryEmail').value = 'Enviando...';
            document.getElementById('recoveryEmail').disabled = true;
        }

        function verifyPattern() {
            if (selectedPattern.length === 0) {
                alert('‚ùå Por favor, dibuja tu patr√≥n');
                return;
            }
            
            // Verificar patr√≥n (en este caso, cualquier patr√≥n es v√°lido para demo)
            if (selectedPattern.length >= 4) {
                alert(`‚úÖ Patr√≥n verificado correctamente\n\nüë§ Usuario: admin\nüîë Contrase√±a: 123456`);
                closeRecoveryModal();
            } else {
                alert('‚ùå El patr√≥n debe tener al menos 4 puntos');
            }
        }

        function simulateFingerprint() {
            const status = document.getElementById('fingerprintStatus');
            status.textContent = 'Escaneando...';
            status.style.background = '#fff3cd';
            status.style.color = '#856404';
            
            setTimeout(() => {
                status.textContent = '‚úÖ Huella reconocida';
                status.style.background = '#d4edda';
                status.style.color = '#155724';
                
                setTimeout(() => {
                    alert(`‚úÖ Acceso autorizado por huella dactilar\n\nüë§ Usuario: admin\nüîë Contrase√±a: 123456`);
                    closeRecoveryModal();
                }, 1000);
            }, 2000);
        }

        function verifySecurityAnswer() {
            const answer = document.getElementById('securityAnswer').value;
            if (!answer) {
                alert('‚ùå Por favor, ingresa tu respuesta');
                return;
            }
            
            // En este caso, cualquier respuesta es v√°lida para demo
            if (answer.length >= 2) {
                alert(`‚úÖ Respuesta correcta\n\nüë§ Usuario: admin\nüîë Contrase√±a: 123456`);
                closeRecoveryModal();
            } else {
                alert('‚ùå La respuesta es demasiado corta');
            }
        }

        // ===== SISTEMA DE GESTOS T√ÅCTILES =====

        // Inicializar gestos t√°ctiles
        function initializeGestures() {
            // Verificar si Hammer.js est√° disponible
            if (typeof Hammer === 'undefined') {
                console.log('‚ö†Ô∏è Hammer.js no disponible - gestos deshabilitados');
                return;
            }

            // Gestos para la pantalla principal
            initHomeGestures();
            
            // Gestos para la pantalla de empezamos
            initEmpezamosGestures();
            
            // Gestos para el logo
            initLogoGestures();
            
            // Gestos para consultar peticiones
            initConsultarGestures();
            
            console.log('üëÜ Gestos t√°ctiles inicializados');
        }

        // Gestos para la pantalla principal
        function initHomeGestures() {
            const container = document.querySelector('.container');
            if (!container) return;

            const hammer = new Hammer(container);
            
            // Deslizar hacia arriba para ir a "Empezamos"
            hammer.get('swipe').set({ direction: Hammer.DIRECTION_ALL });
            
            hammer.on('swipeup', function(e) {
                if (!document.getElementById('empezamosScreen').classList.contains('hidden')) return;
                if (!document.getElementById('consultarScreen').classList.contains('hidden')) return;
                if (!document.getElementById('adminPanel').classList.contains('hidden')) return;
                
                showGestureHint('‚¨ÜÔ∏è Deslizar hacia arriba detectado');
                setTimeout(() => goToEmpezamos(), 300);
            });

            // Deslizar hacia la izquierda para consultar peticiones
            hammer.on('swipeleft', function(e) {
                if (!document.getElementById('empezamosScreen').classList.contains('hidden')) return;
                if (!document.getElementById('consultarScreen').classList.contains('hidden')) return;
                if (!document.getElementById('adminPanel').classList.contains('hidden')) return;
                
                showGestureHint('‚¨ÖÔ∏è Deslizar hacia la izquierda detectado');
                setTimeout(() => goToConsultar(), 300);
            });

            // Deslizar hacia la derecha para panel de admin (solo si est√° logueado)
            hammer.on('swiperight', function(e) {
                if (!isAdminLoggedIn) return;
                if (!document.getElementById('empezamosScreen').classList.contains('hidden')) return;
                if (!document.getElementById('consultarScreen').classList.contains('hidden')) return;
                if (!document.getElementById('adminPanel').classList.contains('hidden')) return;
                
                showGestureHint('‚û°Ô∏è Deslizar hacia la derecha detectado');
                setTimeout(() => showAdminPanel(), 300);
            });
        }

        // Gestos para la pantalla de empezamos
        function initEmpezamosGestures() {
            const empezamosContainer = document.getElementById('empezamosScreen');
            if (!empezamosContainer) return;

            const hammer = new Hammer(empezamosContainer);
            hammer.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });

            // Deslizar hacia la derecha para persona anterior
            hammer.on('swiperight', function(e) {
                if (empezamosContainer.classList.contains('hidden')) return;
                
                if (currentEmpezamosIndex > 0) {
                    showGestureHint('‚û°Ô∏è Persona anterior');
                    setTimeout(() => previousPersonEmpezamos(), 200);
                } else {
                    showGestureHint('‚ö†Ô∏è Ya est√°s en la primera persona');
                }
            });

            // Deslizar hacia la izquierda para persona siguiente
            hammer.on('swipeleft', function(e) {
                if (empezamosContainer.classList.contains('hidden')) return;
                
                showGestureHint('‚¨ÖÔ∏è Persona siguiente');
                setTimeout(() => nextPersonEmpezamos(), 200);
            });

            // Doble toque para guardar r√°pido
            hammer.on('doubletap', function(e) {
                if (empezamosContainer.classList.contains('hidden')) return;
                
                saveCurrentPersonData();
                showGestureHint('üíæ Datos guardados (doble toque)');
            });
        }

        // Gestos para el logo
        function initLogoGestures() {
            const logoSection = document.querySelector('.logo-section');
            if (!logoSection) return;

            const hammer = new Hammer(logoSection);
            
            // Habilitar gestos de pellizco
            hammer.get('pinch').set({ enable: true });

            // Pellizcar para cambiar tama√±o del logo (solo admin)
            hammer.on('pinch', function(e) {
                if (!isAdminLoggedIn) return;
                if (!document.getElementById('logoModal').classList.contains('hidden')) return;
                
                const scale = e.scale;
                let newSize = Math.round(currentLogoSize * scale);
                newSize = Math.max(120, Math.min(newSize, 200)); // L√≠mites seguros
                
                if (newSize !== currentLogoSize) {
                    currentLogoSize = newSize;
                    applyLogoChanges();
                    showGestureHint(`üîç Tama√±o del logo: ${newSize}px`);
                }
            });

            // Doble toque para abrir editor de logo (solo admin)
            hammer.on('doubletap', function(e) {
                if (!isAdminLoggedIn) return;
                if (logoSection.contains(e.target) || e.target === logoSection) {
                    showGestureHint('‚úèÔ∏è Abriendo editor de logo');
                    setTimeout(() => editLogo(), 300);
                }
            });
        }

        // Gestos para consultar peticiones
        function initConsultarGestures() {
            const consultarContainer = document.getElementById('consultarScreen');
            if (!consultarContainer) return;

            const hammer = new Hammer(consultarContainer);
            hammer.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });

            // Deslizar para cambiar p√°ginas
            hammer.on('swipeleft', function(e) {
                if (consultarContainer.classList.contains('hidden')) return;
                
                const totalPages = Math.ceil(filteredPdfs.length / pdfsPerPage);
                if (currentPage < totalPages) {
                    showGestureHint('‚¨ÖÔ∏è P√°gina siguiente');
                    setTimeout(() => nextPage(), 200);
                } else {
                    showGestureHint('‚ö†Ô∏è Ya est√°s en la √∫ltima p√°gina');
                }
            });

            hammer.on('swiperight', function(e) {
                if (consultarContainer.classList.contains('hidden')) return;
                
                if (currentPage > 1) {
                    showGestureHint('‚û°Ô∏è P√°gina anterior');
                    setTimeout(() => previousPage(), 200);
                } else {
                    showGestureHint('‚ö†Ô∏è Ya est√°s en la primera p√°gina');
                }
            });
        }

        // Mostrar hint de gesto
        function showGestureHint(message) {
            // Crear elemento de hint
            const hint = document.createElement('div');
            hint.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 16px;
                font-weight: 600;
                z-index: 4000;
                backdrop-filter: blur(10px);
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                opacity: 0;
                transition: opacity 0.3s ease;
                pointer-events: none;
                text-align: center;
                max-width: 80%;
            `;
            hint.textContent = message;
            
            document.body.appendChild(hint);
            
            // Animar entrada
            setTimeout(() => {
                hint.style.opacity = '1';
            }, 100);
            
            // Animar salida y eliminar
            setTimeout(() => {
                hint.style.opacity = '0';
                setTimeout(() => {
                    if (hint.parentNode) {
                        hint.parentNode.removeChild(hint);
                    }
                }, 300);
            }, 2000);
        }

        // Gestos adicionales para accesibilidad
        function initAccessibilityGestures() {
            // Gesto de tres dedos para mostrar ayuda
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length === 3) {
                    showGestureHelp();
                }
            });

            // Agitar para mostrar informaci√≥n de debug (simulado con movimiento r√°pido)
            let lastAcceleration = { x: 0, y: 0, z: 0 };
            
            if (window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', function(e) {
                    const acceleration = e.accelerationIncludingGravity;
                    if (!acceleration) return;
                    
                    const deltaX = Math.abs(acceleration.x - lastAcceleration.x);
                    const deltaY = Math.abs(acceleration.y - lastAcceleration.y);
                    const deltaZ = Math.abs(acceleration.z - lastAcceleration.z);
                    
                    if (deltaX + deltaY + deltaZ > 30) {
                        showDebugInfo();
                    }
                    
                    lastAcceleration = { x: acceleration.x, y: acceleration.y, z: acceleration.z };
                });
            }
        }

        // Mostrar ayuda de gestos
        function showGestureHelp() {
            const helpText = `
                üì± GESTOS DISPONIBLES:
                
                üè† Pantalla Principal:
                ‚Ä¢ ‚¨ÜÔ∏è Deslizar arriba ‚Üí Empezamos
                ‚Ä¢ ‚¨ÖÔ∏è Deslizar izquierda ‚Üí Consultar
                ‚Ä¢ ‚û°Ô∏è Deslizar derecha ‚Üí Admin (si logueado)
                
                üë• Empezamos:
                ‚Ä¢ ‚¨ÖÔ∏è Deslizar izquierda ‚Üí Siguiente persona
                ‚Ä¢ ‚û°Ô∏è Deslizar derecha ‚Üí Persona anterior
                ‚Ä¢ üëÜüëÜ Doble toque ‚Üí Guardar datos
                
                üé® Logo:
                ‚Ä¢ ü§è Pellizcar ‚Üí Cambiar tama√±o (admin)
                ‚Ä¢ üëÜüëÜ Doble toque ‚Üí Editar logo (admin)
                
                üìã Consultar:
                ‚Ä¢ ‚¨ÖÔ∏è Deslizar izquierda ‚Üí P√°gina siguiente
                ‚Ä¢ ‚û°Ô∏è Deslizar derecha ‚Üí P√°gina anterior
                
                ‚ÑπÔ∏è Otros:
                ‚Ä¢ üëÜüëÜüëÜ Tres dedos ‚Üí Esta ayuda
                ‚Ä¢ üì≥ Agitar ‚Üí Info de debug
            `;
            
            alert(helpText);
        }

        // Mostrar informaci√≥n de debug
        function showDebugInfo() {
            const debugInfo = `
                üîß INFORMACI√ìN DE DEBUG:
                
                üìä Estado actual:
                ‚Ä¢ Personas cargadas: ${empezamosPersonas ? empezamosPersonas.length : 0}
                ‚Ä¢ Persona actual: ${currentEmpezamosIndex + 1}
                ‚Ä¢ Admin logueado: ${isAdminLoggedIn ? 'S√≠' : 'No'}
                ‚Ä¢ PDFs guardados: ${allPdfs ? allPdfs.length : 0}
                ‚Ä¢ Tama√±o logo: ${currentLogoSize}px
                
                üì± Gestos:
                ‚Ä¢ Hammer.js: ${typeof Hammer !== 'undefined' ? 'Activo' : 'No disponible'}
                ‚Ä¢ Pantalla: ${window.innerWidth}x${window.innerHeight}
                ‚Ä¢ Orientaci√≥n: ${window.orientation || 'No disponible'}
            `;
            
            console.log(debugInfo);
            showGestureHint('üîß Info de debug en consola');
        }

        // Inicializar gestos cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            // Esperar un poco para que todo se cargue
            setTimeout(() => {
                initializeGestures();
                initAccessibilityGestures();
            }, 1000);
        });

        // ===== REGISTRO DEL SERVICE WORKER =====

        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ Service Worker registrado correctamente:', registration.scope);
                        
                        // Escuchar actualizaciones
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nueva versi√≥n disponible
                                    if (confirm('üîÑ Nueva versi√≥n disponible. ¬øQuieres actualizar?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('‚ùå Error al registrar Service Worker:', error);
                    });
                
                // Escuchar cuando el SW toma control
                navigator.serviceWorker.addEventListener('controllerchange', function() {
                    console.log('üîÑ Service Worker actualizado - recargando p√°gina');
                    window.location.reload();
                });
            });
        } else {
            console.log('‚ö†Ô∏è Service Worker no soportado en este navegador');
        }

        // Detectar si la app se est√° ejecutando como PWA
        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        // Mostrar mensaje de instalaci√≥n PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('üì± PWA instalable detectada');
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar hint de instalaci√≥n despu√©s de 3 segundos
            setTimeout(() => {
                if (!isPWA()) {
                    showInstallHint();
                }
            }, 3000);
        });

        // Mostrar hint de instalaci√≥n
        function showInstallHint() {
            const hint = document.createElement('div');
            hint.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                right: 20px;
                background: #722F37;
                color: white;
                padding: 15px 20px;
                border-radius: 15px;
                font-size: 14px;
                font-weight: 600;
                z-index: 5000;
                box-shadow: 0 10px 30px rgba(114, 47, 55, 0.3);
                display: flex;
                align-items: center;
                justify-content: space-between;
                animation: slideUp 0.3s ease;
            `;
            
            hint.innerHTML = `
                <div>
                    <div style="font-size: 16px; margin-bottom: 5px;">üì± Instalar GenPeticiones</div>
                    <div style="opacity: 0.9; font-size: 12px;">A√±ade la app a tu pantalla de inicio</div>
                </div>
                <div>
                    <button onclick="installPWA()" style="background: #A4C639; color: white; border: none; padding: 8px 15px; border-radius: 8px; font-weight: 600; margin-right: 10px; cursor: pointer;">Instalar</button>
                    <button onclick="dismissInstallHint()" style="background: transparent; color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; border-radius: 8px; font-weight: 600; cursor: pointer;">Ahora no</button>
                </div>
            `;
            
            hint.id = 'installHint';
            document.body.appendChild(hint);
        }

        // Instalar PWA
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(function(choiceResult) {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('‚úÖ PWA instalada por el usuario');
                    } else {
                        console.log('‚ùå Usuario rechaz√≥ la instalaci√≥n');
                    }
                    deferredPrompt = null;
                    dismissInstallHint();
                });
            }
        }

        // Descartar hint de instalaci√≥n
        function dismissInstallHint() {
            const hint = document.getElementById('installHint');
            if (hint) {
                hint.style.animation = 'slideDown 0.3s ease';
                setTimeout(() => {
                    if (hint.parentNode) {
                        hint.parentNode.removeChild(hint);
                    }
                }, 300);
            }
        }

        // A√±adir animaciones CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from { transform: translateY(100%); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            @keyframes slideDown {
                from { transform: translateY(0); opacity: 1; }
                to { transform: translateY(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        console.log('üöÄ GenPeticiones v1.0.0 - Sistema completo implementado');
        console.log('üîë Credenciales por defecto: admin/123456');
        console.log('üéõÔ∏è Panel de administraci√≥n disponible');
        console.log('üìã Sistema de consulta de peticiones activo');
        console.log('‚≠ê Sistema de gesti√≥n de personas implementado');
        console.log('üéâ Pantalla final de proceso completado activa');
        console.log('üîê Sistema de recuperaci√≥n de credenciales activo');
        console.log('üëÜ Sistema de gestos t√°ctiles implementado');
        console.log('üì± PWA Service Worker registrado');
    </script>
</body>
</html>